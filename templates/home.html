{% extends "base.html" %}

{% block content %}

<div class="row g-4 align-items-center mb-4">
  <div class="col-lg-7">
    <div class="hero-card p-4 p-md-5 rounded-4 shadow-sm">
      <h1 class="display-6 fw-bold mb-3 text-white">
        Sugarcane Transcriptome Database
      </h1>
      <p class="lead text-light mb-4">
        High-throughput transcript sequences from multiple sugarcane cultivars,
        with fast filtering by cultivar, GC content, and sequence length.
      </p>
      <div class="d-flex flex-wrap gap-2">
        <a href="{{ url_for('search') }}" class="btn btn-light btn-lg">
          <i class="bi bi-search me-2"></i> Explore Sequences
        </a>
        <a href="{{ url_for('about') }}" class="btn btn-outline-light btn-lg">
          <i class="bi bi-info-circle me-2"></i> Learn More
        </a>
      </div>
    </div>
  </div>
  <div class="col-lg-5">
    <div class="hero-side p-3 p-md-4 rounded-4 shadow-sm text-center">
      <!-- Optional real image; put sugarcane.jpg in static/img -->
      <div class="sugarcane-hero-image mb-3">
        <!-- Uses gradient; if you add sugarcane.jpg we can swap to background-image -->
      </div>
      <p class="mb-1 text-muted">Current database size</p>
      <h2 class="fw-bold mb-0">
        {{ "{:,}".format(stats.total_transcripts | int) }} transcripts
      </h2>
      <p class="mt-2 mb-0 text-success fw-semibold">
        {{ "%.1f" | format(stats.avg_gc or 0) }}% mean GC ·
        {{ "{:,}".format((stats.avg_length or 0) | int) }} bp average length
      </p>
    </div>
  </div>
</div>

<div class="row g-4 mb-4">
  <div class="col-md-4">
    <div class="stat-card rounded-4 p-3 shadow-sm">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <p class="text-muted small mb-1">Total transcripts</p>
          <h3 class="fw-bold mb-0">
            {{ "{:,}".format(stats.total_transcripts | int) }}
          </h3>
        </div>
        <span class="stat-icon bg-soft-green">
          <i class="bi bi-collection"></i>
        </span>
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="stat-card rounded-4 p-3 shadow-sm">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <p class="text-muted small mb-1">Average length</p>
          <h3 class="fw-bold mb-0">
            {{ "{:,}".format((stats.avg_length or 0) | int) }} bp
          </h3>
        </div>
        <span class="stat-icon bg-soft-blue">
          <i class="bi bi-rulers"></i>
        </span>
      </div>
      <p class="small text-muted mb-0 mt-1">
        Range: {{ stats.min_length }} – {{ stats.max_length }} bp
      </p>
    </div>
  </div>

  <div class="col-md-4">
    <div class="stat-card rounded-4 p-3 shadow-sm">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <p class="text-muted small mb-1">Average GC content</p>
          <h3 class="fw-bold mb-0">
            {{ "%.2f" | format(stats.avg_gc or 0) }}%
          </h3>
        </div>
        <span class="stat-icon bg-soft-orange">
          <i class="bi bi-droplet-half"></i>
        </span>
      </div>
      <p class="small text-muted mb-0 mt-1">
        Calculated per transcript, across all cultivars.
      </p>
    </div>
  </div>
</div>

<div class="row g-4 mb-5">
  <div class="col-lg-8">
    <div class="card rounded-4 shadow-sm h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="card-title mb-0">
            <i class="bi bi-bar-chart-line me-2"></i>
            Transcripts per cultivar
          </h5>
          <span class="badge bg-success-subtle text-success-emphasis">
            {{ stats.cultivar_stats | length }} cultivars
          </span>
        </div>
        <canvas id="cultivarChart" height="140"></canvas>
      </div>
    </div>
  </div>

  <div class="col-lg-4">
    <div class="card rounded-4 shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title mb-3">
          <i class="bi bi-activity me-2"></i>
          Quick summary
        </h5>
        <ul class="list-unstyled mb-0">
          {% for cv, count, avg_gc in stats.cultivar_stats %}
            <li class="mb-2">
              <span class="fw-semibold">{{ cv }}</span><br>
              <span class="small text-muted">
                {{ "{:,}".format(count) }} transcripts ·
                {{ "%.1f" | format(avg_gc or 0) }}% mean GC
              </span>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
{{ super() }}
<script>
  const cultivarLabels = {{ stats.chart.labels | tojson }};
  const cultivarCounts = {{ stats.chart.counts | tojson }};
  const cultivarAvgGC   = {{ stats.chart.avg_gc | tojson }};

  const ctx = document.getElementById('cultivarChart');
  if (ctx) {
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: cultivarLabels,
        datasets: [
          {
            label: 'Transcripts',
            data: cultivarCounts,
            yAxisID: 'y',
          },
          {
            label: 'Mean GC (%)',
            data: cultivarAvgGC,
            type: 'line',
            yAxisID: 'y1',
          }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        stacked: false,
        plugins: {
          legend: { display: true },
        },
        scales: {
          y: {
            position: 'left',
            title: { display: true, text: 'Transcripts' }
          },
          y1: {
            position: 'right',
            grid: { drawOnChartArea: false },
            title: { display: true, text: 'Mean GC (%)' }
          }
        }
      }
    });
  }
</script>
{% endblock %}
